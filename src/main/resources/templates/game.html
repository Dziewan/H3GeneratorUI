<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Heroes 3 Battle Simulator</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/style.css}"/>
</head>
<body>
<header>
    <h1>Heroes 3 Battle Simulator</h1>
</header>

<section>
    <h2>Generate Matches</h2>
    <button id="generateMatchesButton">Generate Matches</button>
    <table id="matches-table">
        <thead>
        <tr>
            <th>Match Number</th>
            <th>Player</th>
            <th>Details</th>
            <th>Player</th>
            <th>Details</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</section>



<section>
    <h2>Re-roll Champion</h2>
    <select id="banned-hero-select">
    </select>
    <button id="rerollChampionButton">Re-roll Champion</button>
    <div id="reroll-champion-details" class="hero-details-card"></div>
</section>


<section>
    <h2>Re-roll Champions</h2>
    <label for="michal-banned-hero">First Player Banned Hero</label>
    <select id="michal-banned-hero">
    </select>
    <label for="daniel-banned-hero">Second Player Banned Hero</label>
    <select id="daniel-banned-hero">
    </select>
    <button id="rerollChampionsButton">Re-roll Champions</button>
    <div id="michal-hero-details" class="hero-details-card"></div>
    <div id="daniel-hero-details" class="hero-details-card"></div>
</section>




<section>
    <h2>Hero Details</h2>
    <select id="hero-select">
    </select>

    <button id="getHeroDetailsButton">Get Details</button>
    <div id="hero-details" class="hero-details-card"></div>
</section>

<footer>
    <p>&copy; 2023 D&D Co. All rights reserved.</p>
</footer>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        $.get("/api/game/heroes", function(data) {
            const heroSelect = $("#hero-select");
            const bannedHeroSelect = $("#banned-hero-select");

            for (const hero of data) {
                heroSelect.append(new Option(hero, hero));
                bannedHeroSelect.append(new Option(hero, hero));
            }

            const michalBannedHeroSelect = $("#michal-banned-hero");
            const danielBannedHeroSelect = $("#daniel-banned-hero");

            for (const hero of data) {
                michalBannedHeroSelect.append(new Option(hero, hero));
                danielBannedHeroSelect.append(new Option(hero, hero));
            }
        });

        const heroDetailsDiv = $("#hero-details");
        const rerollChampionDetailsDiv = $("#reroll-champion-details");

        const matchesTable = $("#matches-table");

        $("#generateMatchesButton").click(function () {
            $.get("/api/game/matches", function (data) {
                const matchesTableBody = $("#matches-table tbody");
                matchesTableBody.empty();

                for (const [index, match] of data.entries()) {
                    const michalDetails = `Fraction: ${match.firstPlayer.army.fraction}, Hero: ${match.firstPlayer.army.hero}, Color: ${match.firstPlayer.color}, Reset Order: ${match.firstPlayer.resetOrder}`;
                    const danielDetails = `Fraction: ${match.secondPlayer.army.fraction}, Hero: ${match.secondPlayer.army.hero}, Color: ${match.secondPlayer.color}, Reset Order: ${match.secondPlayer.resetOrder}`;

                    const row = `<tr>
                <td>Match ${index + 1}</td>
                <td>${match.firstPlayer.name}</td>
                <td>${michalDetails}</td>
                <td>${match.secondPlayer.name}</td>
                <td>${danielDetails}</td>
            </tr>`;

                    matchesTableBody.append(row);
                }
            });
        });

        $("#rerollChampionButton").click(function () {
            var bannedHero = $("#banned-hero-select").val();

            $.ajax({
                url: '/api/game/reroll-champion',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify(bannedHero),
                success: function (data) {
                    rerollChampionDetailsDiv.empty();
                    rerollChampionDetailsDiv.append(`<p class="hero-detail">Hero: ${data}</p>`);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });

        $("#rerollChampionsButton").click(function () {
            var michalBannedHero = $("#michal-banned-hero").val();
            var danielBannedHero = $("#daniel-banned-hero").val();

            var heroPair = {
                michalHero: michalBannedHero,
                danielHero: danielBannedHero
            };

            $.ajax({
                url: '/api/game/reroll-champions',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify(heroPair),
                success: function (data) {
                    var michalHeroDiv = $("#michal-hero-details");
                    var danielHeroDiv = $("#daniel-hero-details");

                    michalHeroDiv.empty();
                    danielHeroDiv.empty();

                    michalHeroDiv.append(`<p class="hero-detail">For first player - > Hero: ${data.michalHero}</p>`);
                    danielHeroDiv.append(`<p class="primary-skill-level-detail">For second player - > Hero: ${data.danielHero}</p>`);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });


        $("#getHeroDetailsButton").click(function () {
            const selectedHero = $("#hero-select").val();

            $.get(`/api/game/hero-details/${selectedHero}`, function (data) {
                heroDetailsDiv.empty();
                heroDetailsDiv.append(`<p class="hero-detail">Hero: ${data.hero}</p>`);
                heroDetailsDiv.append(`<p class="spec-detail">Spec: ${data.spec}</p>`);
                heroDetailsDiv.append(`<p class="primary-skill-detail">Primary Skill: ${data.primarySkillSet.skill} - <span class="level ${data.primarySkillSet.level.toLowerCase()}">Level: ${data.primarySkillSet.level}</span></p>`);
                heroDetailsDiv.append(`<p class="secondary-skill-detail">Secondary Skill: ${data.secondarySkillSet.skill} - <span class="level ${data.secondarySkillSet.level.toLowerCase()}">Level: ${data.secondarySkillSet.level}</span></p>`);
            });
        });
    });
</script>
</html>
